name: Fix Admin Only

on:
    workflow_dispatch:

jobs:
    fix-admin:
        runs-on: ubuntu-latest
        steps:
            - name: Apply Admin Fix via SSH (Raw)
              run: |
                  mkdir -p ~/.ssh/
                  echo "${{ secrets.VPS_SSH_KEY }}" > ~/.ssh/id_rsa
                  chmod 600 ~/.ssh/id_rsa

                  echo "=== CONNECTING TO ${{ secrets.VPS_HOST }} ==="
                  ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} "cd /root/us-paper-cup && docker-compose exec -T web node -e \"const { PrismaClient } = require('@prisma/client'); const prisma = new PrismaClient(); async function main() { await prisma.user.upsert({ where: { email: 'admin@uspapercupfactory.com' }, update: { password: '\$2b\$10\$iUbSRT5127B2Odfx.jZbA.pJeYXTRxvaPuIZ8AQJxlwRRU8eKHuKXH6', role: 'ADMIN' }, create: { email: 'admin@uspapercupfactory.com', password: '\$2b\$10\$iUbSRT5127B2Odfx.jZbA.pJeYXTRxvaPuIZ8AQJxlwRRU8eKHuKXH6', name: 'Admin', role: 'ADMIN' } }); await prisma.\$disconnect(); } main();\""
                  echo "=== FIX APPLIED ==="
