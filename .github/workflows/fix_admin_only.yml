name: Fix Admin Only

on:
    workflow_dispatch:

jobs:
    fix-admin:
        runs-on: ubuntu-latest
        steps:
            - name: Apply Admin Fix via SSH
              uses: appleboy/ssh-action@v1.0.3
              with:
                  host: ${{ secrets.VPS_HOST }}
                  username: ${{ secrets.VPS_USER }}
                  key: ${{ secrets.VPS_SSH_KEY }}
                  script: |
                      echo "=== APPLYING ADMIN FIX ==="
                      cd /root/us-paper-cup
                      docker-compose exec -T web node -e "const { PrismaClient } = require('@prisma/client'); const prisma = new PrismaClient(); async function main() { await prisma.user.upsert({ where: { email: 'admin@uspapercupfactory.com' }, update: { password: '\$2b\$10\$iUbSRT5127B2Odfx.jZbA.pJeYXTRxvaPuIZ8AQJxlwRRU8eKHuKXH6', role: 'ADMIN' }, create: { email: 'admin@uspapercupfactory.com', password: '\$2b\$10\$iUbSRT5127B2Odfx.jZbA.pJeYXTRxvaPuIZ8AQJxlwRRU8eKHuKXH6', name: 'Admin', role: 'ADMIN' } }); await prisma.\$disconnect(); } main();"
                      echo "=== FIX APPLIED ==="
